<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <body class="bg-yellow-50"><head class="bg-yellow-50">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.svg">

  <title>
  Woodland beatdown - Portfolio
  </title>
  <meta name="description" content="2.5D local multiplayer animal fighter made in C&#43;&#43; using the DirectX11 graphics API where my top contributions were a deferred renderer with volume lights, glow effect and shadow mapping with directional light. Collaborated with 5 other people" />
  <meta name="author" content="Filip Karlsson" />
  <meta name="generator" content="Hugo 0.120.4"><link
    rel="stylesheet"
    href="https://blist.vercel.app/css/styles.min.dce8c1039a6fbcc6bbef1b6cab87e57ffa7ece20cc670d9438031cb0bf486f83.css"
    integrity="sha256-3OjBA5pvvMa77xtsq4flf/p+ziDMZw2UOAMcsL9Ib4M="
  />
  
  

  <meta property="og:title" content="Woodland beatdown" />
<meta property="og:description" content="2.5D local multiplayer animal fighter made in C&#43;&#43; using the DirectX11 graphics API where my top contributions were a deferred renderer with volume lights, glow effect and shadow mapping with directional light. Collaborated with 5 other people" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blist.vercel.app/en/blog/woodland-beatdown/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-06-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-06-03T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Woodland beatdown"/>
<meta name="twitter:description" content="2.5D local multiplayer animal fighter made in C&#43;&#43; using the DirectX11 graphics API where my top contributions were a deferred renderer with volume lights, glow effect and shadow mapping with directional light. Collaborated with 5 other people"/>

  <meta itemprop="name" content="Woodland beatdown">
<meta itemprop="description" content="2.5D local multiplayer animal fighter made in C&#43;&#43; using the DirectX11 graphics API where my top contributions were a deferred renderer with volume lights, glow effect and shadow mapping with directional light. Collaborated with 5 other people"><meta itemprop="datePublished" content="2019-06-03T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-06-03T00:00:00+00:00" />
<meta itemprop="wordCount" content="1215">
<meta itemprop="keywords" content="DirectX11,C&#43;&#43;,VS," />

  
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative bg-yellow-50">
  <a href="https://blist.vercel.app/en/" class="capitalize font-extrabold text-2xl">
    
    Portfolio
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-yellow-50 dark:bg-gray-800">

    
    <li><a href="/en/blog">Projects</a></li>
    
    <li><a href="/en/page/about/">About</a></li>
    
    <li><a href="/en/resume/FilipKarlsson_GameProgrammer_CV.pdf">Resume</a></li>
    

    

    

    
    <li class="grid place-items-center">
      <span class="toggle-dark-mode inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="3" />
          <line x1="12" y1="5" x2="12" y2="5.01" />
          <line x1="17" y1="7" x2="17" y2="7.01" />
          <line x1="19" y1="12" x2="19" y2="12.01" />
          <line x1="17" y1="17" x2="17" y2="17.01" />
          <line x1="12" y1="19" x2="12" y2="19.01" />
          <line x1="7" y1="17" x2="7" y2="17.01" />
          <line x1="5" y1="12" x2="5" y2="12.01" />
          <line x1="7" y1="7" x2="7" y2="7.01" />
        </svg>
      </span>
    </li>
    
  </ul>
</header>
<main class="flex-1">
  
  

  
  <div class="relative max-w-5xl mx-auto px-4">
    <img src="/woodland_beatdown_head.png" class="rounded-lg shadow-sm w-full object-contain" />
    
    <div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">
      
  
    June 3, 2019
  


    </div>
    
  </div>
  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Woodland beatdown</h1>
    
    <h5 class="text-sm flex items-center flex-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    June 3, 2019
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      6&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      1215&nbsp;words
      
        
      
    </h5>
    

    <details id="TableOfContents" class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc">
    <summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white">
      <span>Table of contents</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <polyline points="6 9 12 15 18 9"></polyline>
     </svg>
    </summary>

    <ul class="mt-2 pb-4">
        

        
        <li>
        <a href="#deferred-rendering">Deferred rendering</a>
        

        
        </li><li>
        <a href="#shadow-mapping">Shadow mapping</a>
        

        
        </li><li>
        <a href="#glow-map-and-back-to-front">Glow map and back to front</a>
        

        
        </li><li>
        <a href="#reflection">Reflection</a>
        </li></ul>
  </details>

    
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/JDSuGOHlfNI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>In this project we were 6 people in total and were tasked to create a game with DirectX 11 and C++. We landed on animal fighter with a gun-game mechanic. Each time you defeat an opponent you switch to the next animal. Having the last animal and defeating someone makes you the winner. We had our own group room where we could meet and work together and plan the game and choose what each member should do.</p>
<p>I chose four different techniques to implement into the game engine. Deferred rendering with light volumes, glow effect, shadow mapping, and back to front rendering with transparent objects. I first implemented a forward renderer so others could test their techniques and the game. Deferred rendering is a different way of rendering opposite to forward rendering when all the objects are rendered directly to the back buffer. Instead in deferred rendering we split the rendering in two steps where the first step is to render to a g-buffer that contains different textures each containing data for the object. The second step renders each light using light volumes and using the data from the g-buffer to draw the pixel.</p>
<h2 id="deferred-rendering">Deferred rendering</h2>
<p>The first step is to create the G-buffer which holds the different textures. In my implementation it has four textures which are both render targets and also shader resources for the second step. Render to these four textures with normal color, world position, texture color and glow map color. Below is an image captured with renderdoc displaying each texture.



<figure class="image is-3by2">
  <img alt="G-buffer" src="/G-buffer_hu015e4eb4ce5b2b357651cc881ea1fbf1_111058_600x400_fit_box_3.png"/>
</figure>
</p>
<p>After these textures are rendered they can be used as shader resources for the light part. Each point light is rendered using a sphere model which is scaled by the radius of the light and direction light is rendered using a fullscreen quad. The light part has two passes, one where it only renders front faces and writes to the stencil texture for every visible pixel and the second where it uses the stencil and depth texture to render the pixels inside the sphere.</p>
<p>An issue is rendering transparent objects. It is impossible with deferred rendering so to solve this I added an extra array which contains the transparent objects and then use forward rendering after the deferred part. Another issue was the performance of the game. In testing it showed that forward rendering was faster than deferred rendering. (I think the amount of lights used in the game wasn&rsquo;t enough to gain the benefits of using deferred rendering.)</p>
<p>An upgrade to this implementation would be to use a third part resulting in three parts. This method is called deferred lighting or light pre-pass and is broadly used in modern engines. This also solves the issue with only having one material in deferred rendering.



<figure class="image is-3by2">
  <img alt="G-buffer" src="/WoodlandBeatdownLightVolume960x600_huccb41601113fe35d5d64bd08ed6902ea_362440_600x400_fit_box_3.png"/>
</figure>
</p>
<h2 id="shadow-mapping">Shadow mapping</h2>
<p>This method will render the models from the perspective of the light and then use this z-buffer when rendering to the scene. Updating the z-buffer only requires the vertex shader to be set in the pipeline so no pixel shader is needed. To render from the light, the view matrix uses the light direction and position and for the projection matrix an ortho matrix is used because the light is directional (sun) and will have the same direction for every light ray. When rendering the scene we use the model in world space and multiply it by these two martices and check if the z-coordinate is lower than the z-buffer. If it is then the pixel is in shadow.</p>
<p>Some known issues with shadow mapping that came up while developing are shadow acne, peter panning, and overshadowing. Shadow acne is when the pixel is determined to be in shadow when it is not. This was solved by using a bias and subtracting the z-cordinate with this bias. Peter panning becomes a problem when the bias is set to high. This will detach the shadows from the object and will make it appear floating. To solve this we can tighten the far and near plane for the scene but keep the models in the shadow map. I solved it by testing different values for the far and near plane to get the best values. Overshadowing is when the scene is huge and the shadow map doesn&rsquo;t cover the whole scene. The outside of the shadow map will be shaded and to fix this a clamp sample is used when sampling the z-buffer and then check if the models z-coordninate is bigger than 1.</p>
<p>Another issue with this implementation is transparent objects. In this game we had grass models which were quads with grass textures and the shadow became a rectangle. Because of this we decided to remove transparent objects from being rendered in the shadow map. One more issue that didn&rsquo;t effect this project was moving the light camera with the player camera. In our game with fixed camera the shadow map can be configured to render the whole scene and not move the light camera. With a first person shooter for example where the player moves alot and to new location the light camera needs to follow the player camera.</p>
<h2 id="glow-map-and-back-to-front">Glow map and back to front</h2>
<p>I also created the glow post processing which uses a horizontal and vertical gaussian blur with vertex and pixel shader. This was used for moving platforms and glowing mushrooms in the background. It takes the glow map from the g-buffer and calculates the texture coordinates in the vertex shader and then uses them in the pixel shader to sample the neighbours and adding them together to create the blurred pixel. This is first done horizontally and then verticaly in a second pass. The blurred texture is then used in the light shader and only added when rendering the directional light.</p>
<p>Back to front rendering is used to render transparent objects. A selection sort is used on the array of transparent objects and then each object in that array is rendered. The objects are sorted using the distance from the camera to the object. While developing the game this function used a lot of the CPU time so my first solution was to execute it every 30th frame. This was a bad idea because it would lag the game every 30th frame which was worse than having a constant bad framerate. With more important tasks and no other solution and the deadline approached we decided to not order the objects and to keep the function but not executing it for later use and optimization.</p>
<h2 id="reflection">Reflection</h2>
<p>This was the first game project using DirectX11 so it was a good learning experience. Using the Visual Studio Graphics Debugger was a huge help when creating the different techniques and creating my first game engine with models and textures. It also taught me that different solutions are perfect for our game but might not be good in another game. For example the deferred renderer might have been good in a big scene with lots of lights but in our game a forward renderer is sufficient enough. Being my first group game project, it taught me how valuable a clear plan is and also having good communication with eachother. If there were more time I would like to improve the transparent rendering by using order independent transparency and also to sort using BSP trees.</p>

  </article>
<div class="px-2 mb-2">
  
  <script src="https://giscus.app/client.js"
    data-repo=""
    data-repo-id=""
    data-category=""
    data-category-id=""
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
  
</div>
<div class="bg-orange-500 dark:bg-gray-900">
  <div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60">I work on games and share my progress</p>
    </div>

    <ul class="flex justify-center gap-x-3 flex-wrap gap-y-2">
      

      

      

      
      <li>
        <a
          href="https://www.linkedin.com/in/filip-karlsson-holger/"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      



      

      

      

      

      
      <li>
        <a
          href="https://github.com/xfac11"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      



      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://scholar.google.com/citations?user=myOmEckAAAAJ&amp;hl=en&amp;authuser=1"
          target="_blank"
          rel="noopener"
          aria-label="Google Scholar"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-brand-googlescholar"
              width="22"
              height="23"
              viewBox="0 0 24 24"
              stroke-width="1.4"
              stroke="currentColor"
              fill="none">
            <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
          </svg>
        </a>
      </li>
      

      

      

      


    </ul>
  </div>
</div>

      </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2023 - Filip Karlsson · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>








<script>
  
  const darkmode = document.querySelector('.toggle-dark-mode');
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark')
      localStorage.setItem('darkmode', 'light')
    } else {
      document.documentElement.classList.add('dark')
      localStorage.setItem('darkmode', 'dark')
    }
  }
  if (darkmode) {
    darkmode.addEventListener('click', toggleDarkMode);
  }

  const darkStorage = localStorage.getItem('darkmode');
  const isBrowserDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (!darkStorage && isBrowserDark) {
    document.documentElement.classList.add('dark');
  }

  if (darkStorage && darkStorage === 'dark') {
    toggleDarkMode();
  }
</script>


<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
  </body>
</html>
