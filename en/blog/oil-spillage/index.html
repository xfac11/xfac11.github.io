<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <body class="bg-yellow-50"><head class="bg-yellow-50">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.svg">

  <title>
  Oil Spillage - Portfolio
  </title>
  <meta name="description" content="Top down car shooter made in C&#43;&#43; using the DirectX11 graphics API where I made a shadow mapping with directional and spot light, particle system focused on performance with editor and save/load capabilites, Memory and performance optimization, tire tracks using the particle system and compute shader, objective system and UI. Collaborated with 10 other people. " />
  <meta name="author" content="Filip Karlsson" />
  <meta name="generator" content="Hugo 0.120.4"><link
    rel="stylesheet"
    href="https://blist.vercel.app/css/styles.min.dce8c1039a6fbcc6bbef1b6cab87e57ffa7ece20cc670d9438031cb0bf486f83.css"
    integrity="sha256-3OjBA5pvvMa77xtsq4flf/p+ziDMZw2UOAMcsL9Ib4M="
  />
  
  

  <meta property="og:title" content="Oil Spillage" />
<meta property="og:description" content="Top down car shooter made in C&#43;&#43; using the DirectX11 graphics API where I made a shadow mapping with directional and spot light, particle system focused on performance with editor and save/load capabilites, Memory and performance optimization, tire tracks using the particle system and compute shader, objective system and UI. Collaborated with 10 other people. " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blist.vercel.app/en/blog/oil-spillage/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-08-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-15T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Oil Spillage"/>
<meta name="twitter:description" content="Top down car shooter made in C&#43;&#43; using the DirectX11 graphics API where I made a shadow mapping with directional and spot light, particle system focused on performance with editor and save/load capabilites, Memory and performance optimization, tire tracks using the particle system and compute shader, objective system and UI. Collaborated with 10 other people. "/>

  <meta itemprop="name" content="Oil Spillage">
<meta itemprop="description" content="Top down car shooter made in C&#43;&#43; using the DirectX11 graphics API where I made a shadow mapping with directional and spot light, particle system focused on performance with editor and save/load capabilites, Memory and performance optimization, tire tracks using the particle system and compute shader, objective system and UI. Collaborated with 10 other people. "><meta itemprop="datePublished" content="2020-08-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-08-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="875">
<meta itemprop="keywords" content="DirectX11,C&#43;&#43;,VS," />

  
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative bg-yellow-50">
  <a href="https://blist.vercel.app/en/" class="capitalize font-extrabold text-2xl">
    
    Portfolio
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-yellow-50 dark:bg-gray-800">

    
    <li><a href="/en/blog">Projects</a></li>
    
    <li><a href="/en/page/about/">About</a></li>
    
    <li><a href="/en/resume/FilipKarlsson_GameProgrammer_CV.pdf">Resume</a></li>
    

    

    

    
    <li class="grid place-items-center">
      <span class="toggle-dark-mode inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="3" />
          <line x1="12" y1="5" x2="12" y2="5.01" />
          <line x1="17" y1="7" x2="17" y2="7.01" />
          <line x1="19" y1="12" x2="19" y2="12.01" />
          <line x1="17" y1="17" x2="17" y2="17.01" />
          <line x1="12" y1="19" x2="12" y2="19.01" />
          <line x1="7" y1="17" x2="7" y2="17.01" />
          <line x1="5" y1="12" x2="5" y2="12.01" />
          <line x1="7" y1="7" x2="7" y2="7.01" />
        </svg>
      </span>
    </li>
    
  </ul>
</header>
<main class="flex-1">
  
  

  
  <div class="relative max-w-5xl mx-auto px-4">
    <img src="/oil_spillage_head.PNG" class="rounded-lg shadow-sm w-full object-contain" />
    
    <div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">
      
  
    August 15, 2020
  


    </div>
    
  </div>
  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">Oil Spillage</h1>
    
    <h5 class="text-sm flex items-center flex-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    August 15, 2020
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      5&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      875&nbsp;words
      
        
      
    </h5>
    

    <details id="TableOfContents" class="px-4 mt-4 bg-gray-100 dark:bg-gray-700 rounded toc">
    <summary class="flex items-center font-bold py-2 px-4 cursor-pointer justify-between select-none text-black dark:text-white">
      <span>Table of contents</span>
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <polyline points="6 9 12 15 18 9"></polyline>
     </svg>
    </summary>

    <ul class="mt-2 pb-4">
        

        
        <li>
        <a href="#particle-system">Particle system</a>
        

        
        <ul>
            <li>
        <a href="#add">Add</a>
        

        
        </li><li>
        <a href="#update">Update</a>
        

        
        </li><li>
        <a href="#rendering">Rendering</a>
        

        
        </li><li>
        <a href="#reflection">Reflection</a>
        </li></ul>
    </li></ul>
  </details>

    
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/PP9p77pqGvc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>Oil Spillage was my first big project with a total of 11 members. We were a group of game programmers and technical artists who were divided in different groups with different focus. My group was called the &ldquo;graphics engine&rdquo; where me and one other classmate was part of. We planned to have each object added to the engine before drawing instead of each frame to maximize performance. When the first triangle was on the screen I started to implement meshes and textures for the objects.</p>
<p>The game needed particles for damage and weapon effects so I started to plan and develop the particle system which was a new challenge for me. It had to be on the GPU for performance sake and that was also a new area for me. A particle handler for multiple particle system with save and load for each particle system and a editor created with imgui. I also modified the particle system to create wheel tracks.
After the particle system I created shadows for the engine with both spot and directional light support. Since the game was top down I could assume that for the shadows and use an easier and faster equation.</p>
<p>Apart from the shadows and particle system I also helped with the game logic, UI for the car parts, some modeling and some texturing.</p>
<h2 id="particle-system">Particle system</h2>
<p>The system needed to be on the GPU for fast performance and for this I needed to learn how to use compute shaders. For this
I had a book <strong>Practical Rendering &amp; Computation with Direct3D 1</strong> that taught me how to use them and call them from the CPU side with DirectX11. The book also had
a section with particle systems which I could use for inspiration.</p>
<p>The particle system has three parts to it, <strong>Add</strong>, <strong>Update</strong> and <strong>Rendering</strong>. The image below shows the whole process of the system. First frame we see the particles getting added to the first buffer and then updated and placed in the second buffer. Lastly the partciles are rendered. The next frame the buffers switches places and repeats the previous steps.



<figure class="image is-3by2">
  <img alt="G-buffer" src="/partikelSystemet_huf01ead6c526405e88e82c736935cc36f_32736_600x400_fit_box_3.png"/>
</figure>
</p>
<h3 id="add">Add</h3>
<p>Add dispatches an compute shader which uses a constant buffer that has the initial values for the particles position, direction and a vector with random values. The random vector is used for a generated direction which makes each add more random. The total lifetime for the particle is position w/a value. This is then added to the AppendBuffer and repeated for each particle added.</p>
<h3 id="update">Update</h3>
<p>The physics is done in this part and uses a compute shader that has two buffers, one append and one consume. Deltatime is added to the particles lifetime and if the lifetime is less or equal to zero we don&rsquo;t append it and it dies. If lifetime is more than zero we start to calculate the gravity force applied to it and each particle has a mass and gravity value to make it more flexible. <strong>Vectorfields</strong> are also used for a more lively particle where a size and force value are used. Force to manipulate how much the field should influence the particle and size for how big or small the field should be. These two forces are then added to the velocity of the particle and then the velocity is added to the position multiplied by the delta time. To enable collision with the ground a ground y value was used to check against the particles position.</p>
<h3 id="rendering">Rendering</h3>
<p>At first the particle system used a geometry shader to generate the vertices but because the geometry shader is known to be slow I decided to remove it and only use Vertex and Pixel shader. Three vertices are used to create a triangle that gets rotated each frame. This creates the illusion of a star at 30 fps with big particles but when the particle is small it looks like a circle. I saw this approach on <a href="https://edankwan.com/" target="_blank" rel="noopener">Edan Kwans</a>
 the spirit, a web based particle system. Since the particle buffer resides on the GPU, instanced rendering is necessary. Four different colors can be sent to the shader to be blended between eachother with the particles lifetime. Start and end size is also sent in this part and used with the lifetime to scale the particle.



<figure class="image is-3by2">
  <img alt="G-buffer" src="/partikelTriangle_hu1e02f7437470eba0bef8dea7a3a1314e_12118_600x400_fit_box_3.png"/>
</figure>
</p>
<h3 id="reflection">Reflection</h3>
<p>This particles system was a fun and challenging task that required me to learn new techniques. Compute shaders, compute pipeline, different buffers and indirect instanced rendering to mention some. Communication and feedback from the team was important for the development. I could use that to fix bugs and create new functionality that team members found or wanted. For example when we added snow to a biome one member said that the snow didn&rsquo;t move much. They mentioned vector fields and after researching it I implemented it and showed it again. This constant feedback was used through the whole project and not unique to the particle system. I would improve on this system by adding texture support and blur. When playtesting one tester thought that the flame effect (which used one particle system) looked like slush. By using animated textures with the particle system this could be improved. Another improvement would be to enable collision to objects and not only a ground y value.</p>

  </article>
<div class="px-2 mb-2">
  
  <script src="https://giscus.app/client.js"
    data-repo=""
    data-repo-id=""
    data-category=""
    data-category-id=""
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
  
</div>
<div class="bg-orange-500 dark:bg-gray-900">
  <div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60">I work on games and share my progress</p>
    </div>

    <ul class="flex justify-center gap-x-3 flex-wrap gap-y-2">
      

      

      

      
      <li>
        <a
          href="https://www.linkedin.com/in/filip-karlsson-holger/"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      



      

      

      

      

      
      <li>
        <a
          href="https://github.com/xfac11"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      



      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://scholar.google.com/citations?user=myOmEckAAAAJ&amp;hl=en&amp;authuser=1"
          target="_blank"
          rel="noopener"
          aria-label="Google Scholar"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-brand-googlescholar"
              width="22"
              height="23"
              viewBox="0 0 24 24"
              stroke-width="1.4"
              stroke="currentColor"
              fill="none">
            <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
          </svg>
        </a>
      </li>
      

      

      

      


    </ul>
  </div>
</div>

      </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Copyright © 2023 - Filip Karlsson · All rights reserved
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>








<script>
  
  const darkmode = document.querySelector('.toggle-dark-mode');
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark')
      localStorage.setItem('darkmode', 'light')
    } else {
      document.documentElement.classList.add('dark')
      localStorage.setItem('darkmode', 'dark')
    }
  }
  if (darkmode) {
    darkmode.addEventListener('click', toggleDarkMode);
  }

  const darkStorage = localStorage.getItem('darkmode');
  const isBrowserDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (!darkStorage && isBrowserDark) {
    document.documentElement.classList.add('dark');
  }

  if (darkStorage && darkStorage === 'dark') {
    toggleDarkMode();
  }
</script>


<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
  </body>
</html>
